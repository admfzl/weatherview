# Cloudflare Pages Deployment Configuration
# This file configures deployment for Cloudflare Pages with Functions

name: weatherview-cloudflare

# Build configuration
build:
  command: npm run build:cloudflare
  publish: dist/public
  environment:
    NODE_VERSION: 18
    NPM_VERSION: 9

# Functions configuration (for API routes)
functions:
  node_compat: true
  directory: functions
  
# Environment variables (set in Cloudflare dashboard)
environment_variables:
  - DATABASE_URL
  - NODE_ENV=production

# Headers for API routes
headers:
  - for: "/api/*"
    values:
      Access-Control-Allow-Origin: "*"
      Access-Control-Allow-Methods: "GET, POST, PUT, DELETE"
      Access-Control-Allow-Headers: "Content-Type"

# Redirects for SPA routing
redirects:
  - from: "/*"
    to: "/index.html"
    status: 200
    conditions:
      - "!file_exists"

# Build optimization
build_settings:
  skip_build: false
  root_dir: "."
  functions_src: "functions"